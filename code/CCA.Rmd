---
title: "CCA"
author: "M. Florencia Miguel"
date: "22 de mayo de 2017"
output: html_document
---

```{r initialize, message= FALSE, warning=FALSE}

require(ggplot2)
require(GGally)
require(CCA)

```


```{r}

can<- read.csv("../data/canonical.correlations.csv",header=T,sep=",",dec=".",na.strings="NA")
str(can)

```


```{r variables, echo= TRUE, message= TRUE, warning= TRUE}

#1 to 120 grazed sites, 121 to 190 ungrazed sites
#to grazed sites eliminate ctenomys fru <- can [1:120, 60:71] fru <- fru[,-10]
##to ungrazed sites eliminate ctenomys fru <- can [121:190, 60:69], fru <- fru[,-9]

#Grazed sites

fruG <- can [1:120, 60:71]
fruG <- fruG [, -10]
plantG <- can [1:120, 4:21]


#Ungrazed sites

fruUG <- can [121:190, 60:69]
fruUG <- fruUG [, -9]
plantUG <- can [121:190, 4:21]

```

```{r}

ggpairs(fruG)

ggpairs(plantG)

```

```{r correlations, echo= TRUE, message= TRUE, warning= TRUE}

#weâ€™ll look at the correlations within and between the two sets of variables using the matcor function from the CCA package.

matcor(fruG, plantG)

matcor(fruUG, plantUG)

```

```{r corr coefficients, echo= TRUE, message= TRUE, warning= TRUE}

##Grazed sites

cc1G <- cc(fruG, plantG)

cc1G$cor # display the canonical correlations

cc1G[3:4] # raw canonical coefficients

cc2G <- comput(fruG, plantG, cc1G) # compute canonical loadings

cc2G[3:6] # display canonical loadings
 
##Ungrazed sites

cc1UG <- cc(fruUG, plantUG)

cc1UG$cor # display the canonical correlations

cc1UG[3:4] # raw canonical coefficients

cc2UG <- comput(fruUG, plantUG, cc1UG) # compute canonical loadings

cc2UG[3:6] # display canonical loadings

```

```{r test Grazed sites, echo= TRUE, message= TRUE, warning= TRUE}

#Grazed sites
# tests of canonical dimensions
ev <- (1 - cc1G$cor^2)

n <- dim(fruG)[1]
p <- length(fruG)
q <- length(plantG)
k <- min(p, q)
m <- n - 3/2 - (p + q)/2

w <- rev(cumprod(rev(ev)))

# initialize
d1 <- d2 <- f <- vector("numeric", k)

for (i in 1:k) {
    s <- sqrt((p^2 * q^2 - 4)/(p^2 + q^2 - 5))
    si <- 1/s
    d1[i] <- p * q
    d2[i] <- m * s - p * q/2 + 1
    r <- (1 - w[i]^si)/w[i]^si
    f[i] <- r * d2[i]/d1[i]
    p <- p - 1
    q <- q - 1
}

pv <- pf(f, d1, d2, lower.tail = FALSE)
(dmat <- cbind(WilksL = w, F = f, df1 = d1, df2 = d2, p = pv))


```

```{r test Ungrazed sites, echo= TRUE, message= TRUE, warning= TRUE}

#Ungrazed sites
# tests of canonical dimensions
ev <- (1 - cc1UG$cor^2)

n <- dim(fruUG)[1]
p <- length(fruUG)
q <- length(plantUG)
k <- min(p, q)
m <- n - 3/2 - (p + q)/2

w <- rev(cumprod(rev(ev)))

# initialize
d1 <- d2 <- f <- vector("numeric", k)

for (i in 1:k) {
    s <- sqrt((p^2 * q^2 - 4)/(p^2 + q^2 - 5))
    si <- 1/s
    d1[i] <- p * q
    d2[i] <- m * s - p * q/2 + 1
    r <- (1 - w[i]^si)/w[i]^si
    f[i] <- r * d2[i]/d1[i]
    p <- p - 1
    q <- q - 1
}

pv <- pf(f, d1, d2, lower.tail = FALSE)
(dmat <- cbind(WilksL = w, F = f, df1 = d1, df2 = d2, p = pv))


```


```{r standardized Grazed sites, echo= TRUE, message= TRUE, warning= TRUE}

# standardized fru canonical coefficients diagonal matrix of fru sd's

s1 <- diag(sqrt(diag(cov(fruG))))
s1 %*% cc1G$xcoef

# standardized plant canonical coefficients diagonal matrix of plant sd's
s2 <- diag(sqrt(diag(cov(plantG))))
s2 %*% cc1G$ycoef

```

```{r standardized Ungrazed sites, echo= TRUE, message= TRUE, warning= TRUE}

# standardized fru canonical coefficients diagonal matrix of fru sd's

s1 <- diag(sqrt(diag(cov(fruUG))))
s1 %*% cc1UG$xcoef

# standardized plant canonical coefficients diagonal matrix of plant sd's
s2 <- diag(sqrt(diag(cov(plantUG))))
s2 %*% cc1UG$ycoef


```

```{r biplot Grazed sites, echo= TRUE, message= TRUE, warning= TRUE}

plt.cc (cc1G, d1 = 1, d2= 2, int = 1, type = "v", ind.names = NULL,
var.label = TRUE, Xnames = NULL, Ynames = NULL)


```

```{r biplot Ungrazed sites, echo= TRUE, message= TRUE, warning= TRUE}

plt.cc (cc1UG, d1 = 1, d2 = 2, int = 1, type = "v", ind.names = NULL,
var.label = TRUE, Xnames = NULL, Ynames = NULL)

```

